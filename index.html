<!DOCTYPE html>
<html>
  <head>
    <title>Tepra Web</title>
  </head>
  <body>
    <fieldset>
      <label>
        Height: <input type="number" value="128" id="height" name="height"> px
      </label>
      <br>
      <label>
        Line Margin: <input type="number" value="6" id="margin" name="margin"> px
      </label>
      <br>
      <label>
        Vertical Space: <input type="number" value="12" id="vertical" name="vertical"> px
      </label>
      <br>
      <label>
        Horizontal Space: <input type="number" value="10" id="horizontal" name="horizontal"> px
      </label>
      <br>
      <label>
        Font: <input type="text" value="sans" id="font" name="font">
      </label>
      <br>

      <label>
        Text:<br>
        <textarea id="text" name="text">test</textarea>
      </label>
    </fieldset>

    <canvas id="canvas" style="border: 1px solid black; margin: 10px;"></canvas>

    <script>
      const heightElement = document.getElementById('height');
      const marginElement = document.getElementById('margin');
      const verticalElement = document.getElementById('vertical');
      const horizontalElement = document.getElementById('horizontal');
      const fontElement = document.getElementById('font');
      const textElement = document.getElementById('text');
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      function render() {
        const lines = textElement.value.split('\n');
        const height = heightElement.valueAsNumber;
        const margin = marginElement.valueAsNumber;
        const verticalSpace = verticalElement.valueAsNumber;
        const horizontalSpace = horizontalElement.valueAsNumber;
        const font = fontElement.value;
        const fontSize = Math.floor((height - (lines.length-1)*margin - verticalSpace*2) / lines.length);

        canvas.height = height;
        ctx.font = `${fontSize}px ${font}`;
        canvas.width = horizontalSpace*2 + Math.ceil(Math.max(...lines.map(s => ctx.measureText(s).width)));
        ctx.font = `${fontSize}px ${font}`;
        ctx.textBaseline = 'top';

        lines.forEach((text, i) => {
          ctx.fillText(text, horizontalSpace, verticalSpace + (i+1)*margin + i*fontSize);
        });
      }

      heightElement.addEventListener('input', render);
      marginElement.addEventListener('input', render);
      verticalElement.addEventListener('input', render);
      horizontalElement.addEventListener('input', render);
      fontElement.addEventListener('input', render);
      textElement.addEventListener('input', render);
      render();
    </script>
  </body>
</html>
